<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Template Marketplace Prototype v2</title>
  <style>
    :root{--bg:#0b1020;--card:#121a31;--muted:#9fb0d0;--text:#e9eefb;--acc:#6ea8fe;--ok:#34d399}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(160deg,#0a1022,#111b33);color:var(--text)}
    .wrap{max-width:1180px;margin:0 auto;padding:24px}
    .top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    h1{font-size:28px;margin:0}.muted{color:var(--muted)}
    .pill{background:#1a2748;border:1px solid #28406f;padding:8px 12px;border-radius:999px;font-size:12px}
    .grid{display:grid;grid-template-columns:250px 1fr 360px;gap:14px;margin-top:16px}
    .panel,.card{background:var(--card);border:1px solid #223054;border-radius:14px}
    .panel{padding:14px;height:max-content}
    .filters label{display:block;margin:10px 0 6px;color:var(--muted);font-size:13px}
    select,input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #2d3f68;background:#0f1730;color:var(--text)}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
    .card{padding:12px}
    .badge{font-size:12px;background:#21325a;border:1px solid #2f4c88;border-radius:999px;padding:4px 8px;display:inline-block}
    .price{font-size:20px;font-weight:700;margin:6px 0}
    .btn{border:0;border-radius:10px;padding:10px 12px;background:var(--acc);color:#051021;font-weight:700;cursor:pointer}
    .btn.secondary{background:#1f2f57;color:#dbe8ff;border:1px solid #2d477d}
    .btn.ok{background:var(--ok);color:#052013}
    .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .kpi{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin:14px 0}
    .k{background:#101a34;border:1px solid #24375f;border-radius:12px;padding:10px}
    .k b{font-size:20px}
    .note{font-size:12px;color:var(--muted)}
    .out{white-space:pre-wrap;background:#0c1430;border:1px solid #304a82;padding:10px;border-radius:10px;font-size:12px;min-height:110px}
    .small{font-size:12px;color:#bcd0f5}
    @media(max-width:1080px){.grid{grid-template-columns:1fr}.kpi{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>TemplateHub Prototype <span class="muted">v2 (Auto Content)</span></h1>
      <div class="muted">Usability test: discover → evaluate → buy + auto-generate/publish template listings.</div>
    </div>
    <div class="pill" id="session"></div>
  </div>

  <div class="kpi" id="kpis"></div>

  <div class="grid">
    <aside class="panel filters">
      <h3>Filters</h3>
      <label>Search</label><input type="search" id="search" placeholder="e.g., KPI dashboard"/>
      <label>Category</label><select id="category"><option value="all">All</option></select>
      <label>Price cap: <span id="priceCapLbl">$200</span></label><input type="range" id="priceCap" min="20" max="200" value="200" step="5"/>
      <label>Use case</label>
      <select id="usecase"><option value="all">All</option><option>Sales</option><option>Finance</option><option>Operations</option><option>Founders</option></select>
      <div class="note" style="margin-top:12px">Task: generate 2 new listings from keywords, publish, then complete one checkout.</div>
    </aside>

    <main>
      <div class="row" style="margin-bottom:10px">
        <b id="resultCount">0 templates</b>
        <button class="btn secondary" id="reset">Reset test data</button>
      </div>
      <div class="cards" id="cards"></div>

      <div class="panel" style="margin-top:12px">
        <div class="row"><h3 style="margin:0">Checkout</h3><span id="cartCount" class="badge">0 items</span></div>
        <div id="cartItems" class="muted" style="margin:8px 0">No items yet</div>
        <div class="row">
          <b>Total: <span id="total">$0</span></b>
          <button class="btn" id="checkoutBtn">Simulate Purchase</button>
        </div>
      </div>
    </main>

    <aside class="panel">
      <h3>Automatic Content Generator</h3>
      <label>Seed keyword</label><input id="kw" placeholder="e.g., startup runway tracker" value="startup runway tracker"/>
      <label>Audience</label><select id="aud"><option>Founders</option><option>Finance</option><option>Sales</option><option>Operations</option></select>
      <label>Category</label><select id="catGen"><option>Notion</option><option>Sheets</option><option>Slides</option><option>Docs</option></select>
      <label>Batch size</label><input id="batch" type="number" min="1" max="5" value="2"/>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="genBtn">Generate Drafts</button>
        <button class="btn ok" id="pubBtn">Publish to Catalog</button>
      </div>
      <div class="small" style="margin:8px 0">Generated drafts</div>
      <div class="out" id="out">No drafts generated yet.</div>
      <p class="note">This simulates an automated listing pipeline: keyword → draft title/price/positioning → one-click publish.</p>
    </aside>
  </div>
</div>

<script>
let templates=[
 {id:1,name:'Founder KPI Dashboard',category:'Notion',use:'Founders',price:49,rating:4.8,q:86},
 {id:2,name:'SaaS Financial Model (3-Statement)',category:'Sheets',use:'Finance',price:79,rating:4.9,q:91},
 {id:3,name:'Cold Outreach CRM Pipeline',category:'Airtable',use:'Sales',price:39,rating:4.6,q:84},
 {id:4,name:'Weekly Ops Review Pack',category:'Slides',use:'Operations',price:29,rating:4.5,q:80},
 {id:5,name:'Agency P&L + Capacity Planner',category:'Sheets',use:'Finance',price:69,rating:4.7,q:88},
 {id:6,name:'Hiring Scorecard Kit',category:'Notion',use:'Operations',price:25,rating:4.4,q:76},
 {id:7,name:'B2B Demo Call Script + Objections',category:'Docs',use:'Sales',price:19,rating:4.3,q:72},
 {id:8,name:'Board Update One-Pager',category:'Slides',use:'Founders',price:35,rating:4.7,q:78}
];

const state={cart:[],drafts:[],events:JSON.parse(localStorage.getItem('th2_events')||'[]'),startedAt:Date.now(),session:crypto.randomUUID().slice(0,8)};
const el=id=>document.getElementById(id); const byId=id=>templates.find(t=>t.id===id);
function track(type,data={}){state.events.push({t:new Date().toISOString(),type,...data});localStorage.setItem('th2_events',JSON.stringify(state.events));renderKpis();}
function categories(){return [...new Set(templates.map(t=>t.category))];}
function filtered(){const s=el('search').value.toLowerCase(),c=el('category').value,u=el('usecase').value,p=+el('priceCap').value;return templates.filter(t=>(c==='all'||t.category===c)&&(u==='all'||t.use===u)&&t.price<=p&&(t.name.toLowerCase().includes(s)||t.use.toLowerCase().includes(s)));}
function renderCards(){const list=filtered();el('resultCount').textContent=`${list.length} templates`;el('cards').innerHTML=list.map(t=>`<div class="card"><div class="badge">${t.category}</div><h3>${t.name}</h3><div class="muted">Use case: ${t.use} • ⭐ ${t.rating}</div><div class="price">$${t.price}</div><button class="btn" onclick="addToCart(${t.id})">Add to cart</button></div>`).join('')||'<div class="muted">No templates match filters.</div>'}
function addToCart(id){if(!state.cart.includes(id)){state.cart.push(id);track('add_to_cart',{id});renderCart();}}
function renderCart(){const items=state.cart.map(id=>byId(id));el('cartCount').textContent=`${items.length} items`;el('cartItems').innerHTML=items.length?items.map(i=>`• ${i.name} — $${i.price}`).join('<br>'):'No items yet';el('total').textContent='$'+items.reduce((a,b)=>a+b.price,0)}
function renderKpis(){const e=state.events;const views=e.filter(x=>x.type==='view').length,adds=e.filter(x=>x.type==='add_to_cart').length,co=e.filter(x=>x.type==='checkout').length,gens=e.filter(x=>x.type==='generate').length,pubs=e.filter(x=>x.type==='publish').length;const qVals=templates.filter(t=>typeof t.q==='number').map(t=>t.q);const avgQ=qVals.length?(qVals.reduce((a,b)=>a+b,0)/qVals.length).toFixed(1):'--';el('kpis').innerHTML=`<div class='k'><div class='muted'>Views</div><b>${views}</b></div><div class='k'><div class='muted'>Adds</div><b>${adds}</b></div><div class='k'><div class='muted'>Checkouts</div><b>${co}</b></div><div class='k'><div class='muted'>Drafts generated</div><b>${gens}</b></div><div class='k'><div class='muted'>Drafts published</div><b>${pubs}</b></div><div class='k'><div class='muted'>Avg quality</div><b>${avgQ}</b></div>`}


function qualityScore(name, kw, aud, cat, price){
  let score=50;
  const n=name.toLowerCase(), k=kw.toLowerCase();
  if(n.includes(k.split(' ')[0])) score+=12;
  if(/dashboard|tracker|model|kit|template|planner/.test(n)) score+=10;
  if(aud==='Finance' && /model|financial|runway|p&l|cash/.test(n)) score+=10;
  if(aud==='Sales' && /pipeline|outreach|crm|revenue/.test(n)) score+=10;
  if(aud==='Founders' && /kpi|board|operating|strategy/.test(n)) score+=10;
  if(aud==='Operations' && /ops|workflow|review|scorecard/.test(n)) score+=10;
  if(price>=19 && price<=89) score+=8;
  if(['Notion','Sheets','Slides','Docs','Airtable'].includes(cat)) score+=5;
  return Math.max(1,Math.min(100,score));
}
function suggestionPrice(aud,cat){const base={Founders:39,Finance:59,Sales:29,Operations:35}[aud]||39;const bump={Notion:0,Sheets:20,Slides:-5,Docs:-10,Airtable:10}[cat]||0;return Math.max(19,base+bump)}
function titleFromKeyword(kw,aud){const x=kw.trim().replace(/\b\w/g,m=>m.toUpperCase());const suffix={Founders:'Operating System',Finance:'Financial Toolkit',Sales:'Revenue Engine',Operations:'Ops Command Center'}[aud]||'Template Kit';return `${x} ${suffix}`}
function generateDrafts(){const kw=el('kw').value.trim()||'growth dashboard';const aud=el('aud').value;const cat=el('catGen').value;const n=Math.max(1,Math.min(5,parseInt(el('batch').value||'2')));state.drafts=[];for(let i=0;i<n;i++){const variant=i+1;const name=titleFromKeyword(kw,aud)+(n>1?` v${variant}`:'');const price=suggestionPrice(aud,cat)+(i*5);const q=qualityScore(name,kw,aud,cat,price);state.drafts.push({name,category:cat,use:aud,price,rating:4.4,q});}
 el('out').textContent=state.drafts.map((d,i)=>`${i+1}. ${d.name}\n   Category: ${d.category} | Use case: ${d.use} | Price: $${d.price} | Quality: ${d.q}/100`).join('\n\n');track('generate',{count:state.drafts.length,kw,avgQuality:(state.drafts.reduce((a,b)=>a+b.q,0)/state.drafts.length).toFixed(1)});}

function publishDrafts(){if(!state.drafts.length){alert('Generate drafts first.');return;}let maxId=Math.max(...templates.map(t=>t.id));state.drafts.forEach(d=>templates.push({...d,id:++maxId}));track('publish',{count:state.drafts.length});state.drafts=[];el('out').textContent='Published to catalog ✅';refreshCategorySelect();renderCards();}
function refreshCategorySelect(){const cur=el('category').value;el('category').innerHTML='<option value="all">All</option>';categories().forEach(c=>{const o=document.createElement('option');o.value=c;o.textContent=c;el('category').appendChild(o)});el('category').value=categories().includes(cur)?cur:'all';}

['search','category','usecase'].forEach(id=>el(id).addEventListener('input',()=>{track('filter_change',{id});renderCards();}));
el('priceCap').addEventListener('input',e=>{el('priceCapLbl').textContent='$'+e.target.value;track('filter_price',{v:e.target.value});renderCards();});
el('checkoutBtn').addEventListener('click',()=>{track('checkout',{items:state.cart.length,total:state.cart.map(i=>byId(i).price).reduce((a,b)=>a+b,0)});alert('Purchase simulated.');});
el('genBtn').addEventListener('click',generateDrafts); el('pubBtn').addEventListener('click',publishDrafts);
el('reset').addEventListener('click',()=>{localStorage.removeItem('th2_events');location.reload();});

function init(){el('session').textContent='Session '+state.session;refreshCategorySelect();track('view');renderCards();renderCart();renderKpis();}
init();
</script>
</body>
</html>