<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --accent:#22c55e; --danger:#ef4444; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at top, #1e293b, var(--bg));
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap {
      width: min(92vw, 560px);
      background: color-mix(in srgb, var(--panel) 85%, black 15%);
      border: 1px solid #334155;
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
    }
    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 14px;
    }
    .pill {
      background: #0b1220;
      border: 1px solid #334155;
      border-radius: 999px;
      padding: 6px 10px;
    }
    canvas {
      width: 100%;
      aspect-ratio: 1/1;
      display: block;
      background: #020617;
      border: 1px solid #334155;
      border-radius: 10px;
      image-rendering: pixelated;
    }
    .controls { margin-top: 10px; display:flex; justify-content:space-between; gap:8px; flex-wrap: wrap; font-size: 12px; color:#cbd5e1; }
    button {
      background:#0b1220; color:var(--text); border:1px solid #334155; border-radius:8px; padding:8px 10px; cursor:pointer;
    }
    button:hover { border-color:#64748b; }
    .gameover {
      color: var(--danger);
      font-weight: 700;
      margin-left: 8px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="pill">Score: <strong id="score">0</strong></div>
      <div class="pill">High Score: <strong id="high">0</strong></div>
      <div class="pill">Speed: <strong id="speed">8</strong> fps</div>
      <span class="gameover" id="gameover">Game Over â€” press Space to restart</span>
    </div>
    <canvas id="game" width="420" height="420" aria-label="Snake game"></canvas>
    <div class="controls">
      <div>Controls: Arrow keys / WASD</div>
      <div>
        <button id="restart">Restart</button>
        <button id="pause">Pause</button>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');
      const scoreEl = document.getElementById('score');
      const highEl = document.getElementById('high');
      const speedEl = document.getElementById('speed');
      const gameOverEl = document.getElementById('gameover');
      const restartBtn = document.getElementById('restart');
      const pauseBtn = document.getElementById('pause');

      const size = 21; // 21x21 grid
      const cell = canvas.width / size;
      const baseFps = 8;
      const maxFps = 18;
      let fps = baseFps;
      let acc = 0;
      let last = 0;
      let running = true;
      let dead = false;

      const highKey = 'snake_high_score';
      let high = Number(localStorage.getItem(highKey) || 0);
      highEl.textContent = high;

      let snake, dir, nextDir, food, score;

      function reset() {
        snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
        dir = {x: 1, y: 0};
        nextDir = {x: 1, y: 0};
        score = 0;
        fps = baseFps;
        dead = false;
        running = true;
        gameOverEl.style.display = 'none';
        pauseBtn.textContent = 'Pause';
        placeFood();
        updateHud();
      }

      function updateHud() {
        scoreEl.textContent = score;
        highEl.textContent = high;
        speedEl.textContent = fps;
      }

      function placeFood() {
        while (true) {
          const x = Math.floor(Math.random() * size);
          const y = Math.floor(Math.random() * size);
          if (!snake.some(s => s.x === x && s.y === y)) {
            food = {x, y};
            return;
          }
        }
      }

      function turn(x, y) {
        // prevent 180-degree turns
        if (x === -dir.x && y === -dir.y) return;
        nextDir = {x, y};
      }

      function step() {
        if (!running || dead) return;
        dir = nextDir;
        const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

        // wall collision
        if (head.x < 0 || head.y < 0 || head.x >= size || head.y >= size) {
          return die();
        }
        // self collision
        if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
          return die();
        }

        snake.unshift(head);

        if (head.x === food.x && head.y === food.y) {
          score++;
          if (score > high) {
            high = score;
            localStorage.setItem(highKey, String(high));
          }
          fps = Math.min(maxFps, baseFps + Math.floor(score / 2));
          placeFood();
        } else {
          snake.pop();
        }

        updateHud();
      }

      function die() {
        dead = true;
        running = false;
        gameOverEl.style.display = 'inline';
      }

      function drawGrid() {
        ctx.fillStyle = '#020617';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = 'rgba(148,163,184,0.12)';
        ctx.lineWidth = 1;
        for (let i = 1; i < size; i++) {
          const p = i * cell;
          ctx.beginPath(); ctx.moveTo(p, 0); ctx.lineTo(p, canvas.height); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(0, p); ctx.lineTo(canvas.width, p); ctx.stroke();
        }
      }

      function drawFood() {
        ctx.fillStyle = '#ef4444';
        roundRect(food.x * cell + 2, food.y * cell + 2, cell - 4, cell - 4, 6, true);
      }

      function drawSnake() {
        snake.forEach((s, i) => {
          ctx.fillStyle = i === 0 ? '#22c55e' : '#16a34a';
          roundRect(s.x * cell + 1.5, s.y * cell + 1.5, cell - 3, cell - 3, 5, true);
        });
      }

      function roundRect(x, y, w, h, r, fill) {
        const rr = Math.min(r, w/2, h/2);
        ctx.beginPath();
        ctx.moveTo(x + rr, y);
        ctx.arcTo(x + w, y, x + w, y + h, rr);
        ctx.arcTo(x + w, y + h, x, y + h, rr);
        ctx.arcTo(x, y + h, x, y, rr);
        ctx.arcTo(x, y, x + w, y, rr);
        if (fill) ctx.fill();
      }

      function frame(ts) {
        const dt = (ts - last) / 1000 || 0;
        last = ts;
        acc += dt;

        const stepTime = 1 / fps;
        while (acc >= stepTime) {
          step();
          acc -= stepTime;
        }

        drawGrid();
        drawFood();
        drawSnake();

        requestAnimationFrame(frame);
      }

      window.addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === 'arrowup' || k === 'w') turn(0, -1);
        else if (k === 'arrowdown' || k === 's') turn(0, 1);
        else if (k === 'arrowleft' || k === 'a') turn(-1, 0);
        else if (k === 'arrowright' || k === 'd') turn(1, 0);
        else if (k === ' ') {
          if (dead) reset();
          else {
            running = !running;
            pauseBtn.textContent = running ? 'Pause' : 'Resume';
          }
        }
      });

      restartBtn.addEventListener('click', reset);
      pauseBtn.addEventListener('click', () => {
        if (dead) return;
        running = !running;
        pauseBtn.textContent = running ? 'Pause' : 'Resume';
      });

      reset();
      requestAnimationFrame(frame);
    })();
  </script>
</body>
</html>
